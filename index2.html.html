<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dino-Crisis: Survival Log</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cousine&family=Spectral:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #132a2f;
            --bg-panel: #1a3a42;
            --border-color: #2e535c;
            --text-primary: #e6f1f3;
            --text-secondary: #8cb0b9;
            --text-accent: #ffc888;
            --danger-color: #ff6b6b;
            --success-color: #6bff9b;
            --info-color: #8cb0b9;
        }
        body {
            font-family: 'Cousine', monospace;
            background-color: var(--bg-dark);
            color: var(--text-primary);
        }
        #game-wrapper {
            background-color: var(--bg-panel);
            border: 1px solid var(--border-color);
            box-shadow: 0 0 40px -10px rgba(0,0,0,0.6);
            height: 95vh;
            max-height: 850px;
        }
        .status-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        #game-output::-webkit-scrollbar, .right-panel-content::-webkit-scrollbar { width: 8px; }
        #game-output::-webkit-scrollbar-track, .right-panel-content::-webkit-scrollbar-track { background: var(--bg-panel); }
        #game-output::-webkit-scrollbar-thumb, .right-panel-content::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 4px; }
        
        .command-input {
            background: transparent;
            border-color: var(--border-color);
            color: var(--text-accent);
        }
        .command-input::placeholder { color: var(--text-secondary); }
        .command-input:focus { outline: none; border-color: var(--text-accent); }
        
        .keyword { font-weight: bold; color: var(--text-accent); }
        .fire-text { color: #f59e0b; text-shadow: 0 0 5px #f59e0b; }
        .combat-text-player { color: var(--success-color); }
        .combat-text-enemy { color: var(--danger-color); }
        .item-text { color: var(--text-accent); }
        .location-text { color: #a3d9ff; }

        .panel-header {
            color: var(--text-accent);
            border-bottom: 1px solid var(--border-color);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .action-button, .inventory-action-button {
            background-color: #224a52;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }
        .action-button:hover, .inventory-action-button:hover {
            background-color: var(--border-color);
            border-color: #4a7580;
            color: #fff;
        }

        .inventory-item {
            border: 1px solid transparent;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }
        .inventory-item:hover {
            background-color: rgba(46, 83, 92, 0.5);
            border-color: var(--border-color);
        }
        .inventory-item.selected {
             background-color: var(--bg-dark);
             border-color: var(--border-color);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="game-wrapper" class="w-full max-w-7xl mx-auto rounded-lg grid grid-cols-1 md:grid-cols-3 gap-4 p-4">
        
        <!-- Left Panel: Game Output and Input -->
        <div class="md:col-span-2 flex flex-col h-full bg-black/20 rounded p-4">
            <header class="text-center pb-2 border-b border-[var(--border-color)] mb-4">
                <h1 class="text-3xl font-bold tracking-wider text-[var(--text-accent)] font-spectral">SURVIVAL LOG</h1>
                <p class="text-[var(--text-secondary)]">Temporal Anomaly: KT-BOUNDARY</p>
            </header>
            <div id="game-output" class="flex-grow p-2 overflow-y-auto mb-4 text-base leading-relaxed">
                <!-- Game text will be dynamically inserted here -->
            </div>
            <div class="flex items-center">
                <span class="text-[var(--text-accent)] text-xl mr-2 font-bold">&gt;</span>
                <input type="text" id="command-input" class="command-input border-b-2 w-full text-lg p-2 focus:outline-none transition-all duration-300" placeholder="Enter command or click actions...">
            </div>
        </div>

        <!-- Right Panel: Stats, Inventory, Actions -->
        <div class="flex flex-col space-y-4 overflow-y-auto right-panel-content">
            <!-- Status -->
            <div class="bg-black/20 border border-[var(--border-color)] p-4 rounded-lg">
                <h2 class="panel-header text-lg font-bold pb-2 mb-3">STATUS</h2>
                <div id="stats" class="grid grid-cols-1 gap-3 text-sm tracking-wider">
                     <div>
                        <div class="flex justify-between items-center"><span class="font-bold text-[var(--danger-color)]">VITALITY</span><span id="health-text">100</span></div>
                        <div class="bg-black/30 rounded-full h-2.5 mt-1 overflow-hidden border border-black/50"><div id="health-bar" class="status-bar-fill bg-[var(--danger-color)] h-full"></div></div>
                    </div>
                    <div>
                        <div class="flex justify-between items-center"><span class="font-bold text-[var(--text-accent)]">SUSTENANCE</span><span id="hunger-text">100</span></div>
                        <div class="bg-black/30 rounded-full h-2.5 mt-1 overflow-hidden border border-black/50"><div id="hunger-bar" class="status-bar-fill bg-[var(--text-accent)] h-full"></div></div>
                    </div>
                    <div>
                        <div class="flex justify-between items-center"><span class="font-bold text-[#82cfff]">HYDRATION</span><span id="thirst-text">100</span></div>
                        <div class="bg-black/30 rounded-full h-2.5 mt-1 overflow-hidden border border-black/50"><div id="thirst-bar" class="status-bar-fill bg-[#82cfff] h-full"></div></div>
                    </div>
                    <div>
                        <div class="flex justify-between items-center"><span class="font-bold text-[var(--success-color)]">STAMINA</span><span id="energy-text">100</span></div>
                        <div class="bg-black/30 rounded-full h-2.5 mt-1 overflow-hidden border border-black/50"><div id="energy-bar" class="status-bar-fill bg-[var(--success-color)] h-full"></div></div>
                    </div>
                </div>
            </div>
            <!-- Inventory -->
            <div class="bg-black/20 border border-[var(--border-color)] p-4 rounded-lg flex-grow flex flex-col">
                <h2 class="panel-header text-lg font-bold pb-2 mb-3">INVENTORY</h2>
                <ul id="inventory-list" class="space-y-1 flex-grow">
                    <!-- Inventory items will be here -->
                </ul>
            </div>
            <!-- Actions -->
            <div class="bg-black/20 border border-[var(--border-color)] p-4 rounded-lg">
                <h2 class="panel-header text-lg font-bold pb-2 mb-3">ACTIONS</h2>
                <div id="action-buttons" class="grid grid-cols-2 gap-2">
                    <!-- Action buttons will be here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const output = document.getElementById('game-output');
        const input = document.getElementById('command-input');
        const healthBar = document.getElementById('health-bar');
        const hungerBar = document.getElementById('hunger-bar');
        const thirstBar = document.getElementById('thirst-bar');
        const energyBar = document.getElementById('energy-bar');
        const healthText = document.getElementById('health-text');
        const hungerText = document.getElementById('hunger-text');
        const thirstText = document.getElementById('thirst-text');
        const energyText = document.getElementById('energy-text');
        const inventoryList = document.getElementById('inventory-list');
        const actionButtons = document.getElementById('action-buttons');

        const player = {
            health: 100, hunger: 100, thirst: 100, energy: 100,
            inventory: [], currentLocation: 'crashSite', isResting: false,
        };
        
        let world = {};
        
        // --- DATA POOLS FOR WORLD GENERATION ---
        const locationTemplates = {
            crashSite: { id: 'crashSite', name: "The Wreckage", description: "The hiss of the smoldering temporal pod is the only sound. Twisted metal groans. Towering, alien-looking ferns press in from all sides, their fronds dripping with moisture.", type: 'jungle' },
            deepJungle: { id: 'deepJungle', name: "Deep Jungle", description: "The canopy above is a dense, suffocating blanket, plunging the jungle floor into twilight. The air is thick with the cloying scent of decay and damp earth.", type: 'jungle' },
            clearing: { id: 'clearing', name: "Bone Clearing", description: "A clearing dominated by the colossal, fossilized skeleton of some impossible creature. The sense of ancient death is palpable.", type: 'clearing' },
            stream: { id: 'stream', name: "Shallow Stream", description: "A stream of unnervingly clear water flows over dark, smooth stones. It seems safe, a rare comfort in this hostile world.", type: 'stream' },
            cave: { id: 'cave', name: "Cave Entrance", description: "A dark, damp fissure in the rock. A cold, foul-smelling draft emanates from the darkness within.", type: 'cave' },
            plains: { id: 'plains', name: "The Great Plains", description: "A vast, open grassland stretches to the horizon, dotted with cycad trees. The ground occasionally trembles with unseen, heavy footfalls.", type: 'plains' },
            denseForest: { id: 'denseForest', name: "Dense Forest", description: "Trees here are ancient and tightly packed, their roots like gnarled knuckles. There's a feeling of being watched by hungry eyes.", type: 'jungle' },
            rockyOutcrop: { id: 'rockyOutcrop', name: "Rocky Outcrop", description: "Jagged rocks and boulders create a maze of sharp edges and narrow passages. The wind whistles eerily through the stones.", type: 'clearing' }
        };

        const itemPools = {
            jungle: [
                { id: 'vine', name: 'tough vine', useInfo: 'Useful for crafting or binding things together.', description: 'A long, fibrous vine, surprisingly strong.' },
                { id: 'water_leaf', name: 'rain-filled leaf', useInfo: 'A temporary source of clean water.', description: 'A broad leaf cupping a small amount of rainwater.'},
                { id: 'berries', name: 'dark berries', useInfo: 'A potential food source, but could be risky.', description: 'A cluster of dark, purple berries.' },
                { id: 'root', name: 'fibrous root', useInfo: 'A tough but edible food source.', description: 'A dirty, fibrous root pulled from the ground.'},
                { id: 'herbs', name: 'medicinal herbs', useInfo: 'Can be combined with a binding agent to create a bandage.', description: 'A pungent, leafy green herb.'},
                {id: 'branch', name: 'sturdy branch', useInfo: 'A solid piece of hardwood. Could be useful for crafting.', description: 'A thick, sturdy tree branch.'}
            ],
            clearing: [ { id: 'rock', name: 'flint shard', useInfo: 'The edge is sharp enough for cutting or fighting. Can be struck to create sparks.', description: 'A piece of flint with a razor-sharp edge.' } ],
            cave: [ { id: 'wood', name: 'dry wood', useInfo: 'Excellent tinder for a fire.', description: 'A pile of brittle, dry wood.' } ]
        };
        
        const dinoPools = {
            jungle: [
                { name: 'Compsognathus pack', health: 20, damage: 5, chance: 0.3, loot: null },
                { name: 'Stalking Allosaurus', health: 150, damage: 40, chance: 0.2, loot: { id: 'raw_meat', name: 'raw meat', useInfo: 'Should be cooked before eating.', description: 'A fresh slab of raw meat.' }}
            ],
            clearing: [
                { name: 'Charging Carnotaurus', health: 120, damage: 35, chance: 0.25, loot: { id: 'raw_meat', name: 'raw meat', useInfo: 'Should be cooked before eating.', description: 'A fresh slab of raw meat.' }}
            ],
            plains: [
                { name: 'Towering Diplodocus', health: 300, damage: 25, chance: 0.05, loot: { id: 'large_raw_meat', name: 'large raw meat', useInfo: 'An enormous slab of meat. Needs cooking.', description: 'Enough meat to feed you for days.' }}
            ],
            stream: [ { name: 'Gallimimus', health: 30, damage: 5, chance: 0.4, loot: { id: 'raw_meat_small', name: 'small raw meat', useInfo: 'Should be cooked before eating.', description: 'A small piece of raw meat.' }} ],
            cave: [ { name: 'Territorial Utahraptor', health: 90, damage: 30, chance: 0.3, loot: null } ]
        };

        const recipes = {
            "rock_vine": { name: 'sharpened spear', id: 'spear', description: 'A flint shard tied to a vine-wrapped stick. A proper weapon.', useInfo: 'A deadly weapon for hunting.'},
            "herbs_vine": { name: 'crude bandage', id: 'bandage', description: 'Medicinal herbs wrapped in a tough vine.', useInfo: 'Use to restore a significant amount of vitality.'}
        };

        // --- WORLD GENERATION LOGIC ---
        function generateWorld() {
            let newWorld = {};
            const locationIds = Object.keys(locationTemplates);
            
            for(const id of locationIds) {
                newWorld[id] = { ...JSON.parse(JSON.stringify(locationTemplates[id])), exits: {}, items: [], dino: null, isFireLit: false };
            }

            const directions = ['north', 'south', 'east', 'west'];
            const opposite = { north: 'south', south: 'north', east: 'west', west: 'east' };
            let unlinked = [...locationIds];
            let linked = [unlinked.shift()]; 

            while(unlinked.length > 0) {
                const aId = linked[Math.floor(Math.random() * linked.length)];
                const bId = unlinked.splice(Math.floor(Math.random() * unlinked.length), 1)[0];
                
                const availableDirsA = directions.filter(d => !newWorld[aId].exits[d]);
                
                if (availableDirsA.length > 0) {
                    const dirA = availableDirsA[Math.floor(Math.random() * availableDirsA.length)];
                    const dirB = opposite[dirA];
                     if (!newWorld[bId].exits[dirB]) {
                        newWorld[aId].exits[dirA] = bId;
                        newWorld[bId].exits[dirB] = aId;
                        linked.push(bId);
                    } else {
                       unlinked.push(bId); 
                    }
                } else {
                     unlinked.push(bId); 
                }
            }

            for(const id of locationIds) {
                const loc = newWorld[id];
                const type = loc.type;
                if (itemPools[type]) {
                    itemPools[type].forEach(item => {
                        if (Math.random() < 0.4) { loc.items.push(JSON.parse(JSON.stringify(item))); }
                    });
                }
                if (id !== 'crashSite' && dinoPools[type]) {
                    if (Math.random() < 0.5) {
                        const dinoTemplate = dinoPools[type][Math.floor(Math.random() * dinoPools[type].length)];
                        loc.dino = JSON.parse(JSON.stringify(dinoTemplate));
                    }
                }
            }
             if (!Object.values(newWorld).some(loc => loc.items.some(i => i.id === 'rock'))) {
                const randomClearing = locationIds.find(id => newWorld[id].type === 'clearing') || 'clearing';
                newWorld[randomClearing].items.push(JSON.parse(JSON.stringify(itemPools.clearing[0])));
            }


            world = newWorld;
        }

        // --- CORE GAME LOGIC ---
        function executeCommand(command) {
            if (!command) return;
            printToOutput(`<span style="color:var(--text-secondary)">&gt; ${command}</span>`);
            parseCommand(command);
            input.value = '';
        }

        function parseCommand(command) {
            const parts = command.toLowerCase().trim().split(' ');
            const action = parts[0];
            const target1 = parts[1];
            const target2 = parts.length > 3 ? parts[3] : null;

            if (player.health <= 0) return;
            if (player.isResting && action !== 'stop') {
                printToOutput("You are resting. Command 'stop resting' to continue.", "text-yellow-400/80");
                return;
            }

            switch (action) {
                case 'go': movePlayer(target1); break;
                case 'look': case 'l': lookAround(); break;
                case 'take': takeItem(parts.slice(1).join(' ')); break;
                case 'use': useItem(parts.slice(1).join(' ')); break;
                case 'uses': checkUses(parts.slice(1).join(' ')); break;
                case 'drink': drinkWater(); break;
                case 'rest': rest(); break;
                case 'stop': if (target1 === 'resting') stopResting(); break;
                case 'attack': attackCreature(parts.slice(1).join(' ')); break;
                case 'bind': bindItems(target1, target2); break;
                case 'drop': dropItem(parts.slice(1).join(' ')); break;
                case 'help': showHelp(); break;
                default: printToOutput("Unknown command. Use 'help' for options.", "text-slate-500");
            }
            if(action && !['stop', 'help', 'inventory', 'look', 'l', 'uses'].includes(action)) {
                 if (!player.isResting) tick();
            }
        }
        
        function movePlayer(direction) {
            const location = world[player.currentLocation];
            const newLocationId = location.exits[direction];
            if (newLocationId) {
                if (player.energy <= 0) { printToOutput("Stamina depleted. Unable to move.", "text-yellow-400/80"); return; }
                player.currentLocation = newLocationId;
                updateStats({ energy: -5 });
                lookAround();
                const newLocation = world[player.currentLocation];
                if (newLocation.dino && Math.random() < newLocation.dino.chance) {
                     printToOutput(`A wild ${newLocation.dino.name} emerges and attacks!`, "combat-text-enemy font-bold");
                     updateStats({ health: -newLocation.dino.damage });
                     printToOutput(`It deals ${newLocation.dino.damage} damage.`, "combat-text-enemy");
                }
            } else {
                printToOutput("That path is impassable.", "text-slate-500");
            }
        }

        function lookAround() {
            const location = world[player.currentLocation];
            printToOutput(`\n<span class='text-xl location-text tracking-wider font-spectral'>${location.name}</span>`);
            printToOutput(location.description, "text-primary");
            if (location.isFireLit) printToOutput("A small, crackling fire burns here.", "fire-text");
            if (location.dino) printToOutput(`A <span class="keyword">${location.dino.name}</span> is here.`, "text-yellow-400/80");
             const exitKeys = Object.keys(location.exits);
            if (exitKeys.length > 0) {
                const formattedExits = exitKeys.map(dir => `<span class='keyword'>${dir}</span>`).join(', ');
                printToOutput(`Obvious paths lead: ${formattedExits}.`, "text-secondary");
            }
            if (location.items.length > 0) printToOutput("On the ground: " + location.items.map(item => `<span class='item-text'>${item.name}</span>`).join(', ') + ".", "text-secondary");
            updateActionButtons();
        }

        function takeItem(itemName) {
            const location = world[player.currentLocation];
            const itemIndex = location.items.findIndex(item => item.name.includes(itemName));
            if (itemIndex !== -1) {
                const [item] = location.items.splice(itemIndex, 1);
                player.inventory.push(item);
                printToOutput(`Acquired: <span class="item-text">${item.name}</span>.`, "text-sky-300/80");
                updateStats({ energy: -2 });
                updateInventory();
                updateActionButtons();
            } else {
                printToOutput("Object not found.", "text-slate-500");
            }
        }
        
        function dropItem(itemName) {
            const itemIndex = player.inventory.findIndex(i => i.name.includes(itemName));
            if (itemIndex > -1) {
                const [item] = player.inventory.splice(itemIndex, 1);
                world[player.currentLocation].items.push(item);
                printToOutput(`Dropped ${item.name}.`, 'text-secondary');
                updateInventory();
                updateActionButtons();
            }
        }
        
        function attackCreature(targetName) {
            const location = world[player.currentLocation];
            if (!location.dino || !location.dino.name.toLowerCase().includes(targetName)) {
                printToOutput(`You don't see that here.`, "text-slate-500"); return;
            }

            const hasSpear = player.inventory.some(i => i.id === 'spear');
            const hasShard = player.inventory.some(i => i.id === 'rock');
            const playerDamage = hasSpear ? 40 : (hasShard ? 25 : 10);
            const weaponUsed = hasSpear ? 'sharpened spear' : (hasShard ? 'flint shard' : 'fists');
            
            printToOutput(`You attack the ${location.dino.name} with your ${weaponUsed}!`, "combat-text-player");
            updateStats({ energy: -10 });
            location.dino.health -= playerDamage;
            
            if(location.dino.health <= 0) {
                printToOutput(`You have defeated the ${location.dino.name}!`, "success-color font-bold");
                if (location.dino.loot) {
                    const lootItem = JSON.parse(JSON.stringify(location.dino.loot));
                    location.items.push(lootItem);
                    printToOutput(`It dropped ${lootItem.name}.`, "text-sky-300/80");
                }
                location.dino = null;
                updateActionButtons();
            } else {
                printToOutput(`The ${location.dino.name} retaliates!`, "combat-text-enemy");
                updateStats({ health: -location.dino.damage });
                printToOutput(`It deals ${location.dino.damage} damage to you.`, "combat-text-enemy");
            }
        }
        
        function useItem(itemName) {
            const itemIndex = player.inventory.findIndex(item => item.name.includes(itemName));
            if (itemIndex === -1) { printToOutput("Item not in inventory.", "text-slate-500"); return; }
            
            const item = player.inventory[itemIndex];
            const location = world[player.currentLocation];
            let used = true;

            switch(item.id) {
                case 'berries':
                    printToOutput("You consume the dark berries...", "text-yellow-300/80");
                    if (Math.random() > 0.7) {
                        printToOutput("A wave of nausea hits you. They're toxic.", "danger-color");
                        updateStats({ health: -20, hunger: 15 });
                    } else {
                        printToOutput("They are bitter, but stave off your hunger.", "success-color");
                        updateStats({ hunger: 30 });
                    }
                    break;
                case 'root': updateStats({ hunger: 15 }); break;
                case 'water_leaf': updateStats({ thirst: 25 }); break;
                case 'bandage': updateStats({ health: 40 }); printToOutput("You apply the bandage. The bleeding stops and you feel much better.", "success-color"); break;
                case 'wood':
                    if (location.isFireLit) { printToOutput("You add wood to the fire.", "fire-text"); }
                    else if (player.inventory.some(i => i.id === 'rock')) {
                        printToOutput("You arrange the dry wood and strike the flint shard. A small flame catches. You've made a fire!", "fire-text");
                        location.isFireLit = true;
                    } else { printToOutput("You need something to create a spark.", "text-slate-400"); used = false; }
                    break;
                case 'raw_meat': case 'raw_meat_small': case 'large_raw_meat':
                    if (location.isFireLit) {
                        printToOutput("You cook the meat over the fire.", "item-text");
                        const size = item.id.includes('large') ? 'large ' : item.id.includes('small') ? 'small ' : '';
                        player.inventory.push({ id: 'cooked_meat', name: `cooked ${size}meat`, useInfo: 'A safe and highly nutritious food source.', description: `A piece of perfectly cooked ${size}meat.`});
                    } else { printToOutput("You should cook this first.", "text-yellow-400/80"); used = false; }
                    break;
                case 'cooked_meat':
                    const hungerGain = item.name.includes('large') ? 100 : item.name.includes('small') ? 35 : 60;
                    updateStats({ health: 15, hunger: hungerGain, energy: 10 });
                    break;
                default: printToOutput(`No obvious use for the ${item.name} right now.`, "text-slate-500"); used = false;
            }
            if(used) {
                player.inventory.splice(itemIndex, 1);
                updateInventory();
            }
        }
        
        function bindItems(item1Name, item2Name) {
            const item1 = player.inventory.find(i => item1Name && i.name.includes(item1Name));
            const item2 = player.inventory.find(i => item2Name && i.name.includes(item2Name));

            if (!item1 || !item2) { printToOutput("You need both items in your inventory to bind them.", "text-slate-500"); return; }
            
            let recipeKey = null;
            if ((item1.id.includes('rock') && item2.id.includes('vine')) || (item1.id.includes('vine') && item2.id.includes('rock'))) { recipeKey = "rock_vine"; }
            else if ((item1.id.includes('herbs') && item2.id.includes('vine')) || (item1.id.includes('vine') && item2.id.includes('herbs'))) { recipeKey = "herbs_vine"; }

            if (recipeKey) {
                const newItem = recipes[recipeKey];
                player.inventory = player.inventory.filter(i => i.id !== item1.id && i.id !== item2.id);
                player.inventory.push(newItem);
                printToOutput(`You successfully crafted a ${newItem.name}.`, "success-color");
                updateInventory();
            } else { printToOutput("You can't seem to combine those items in any useful way.", "text-yellow-400/80"); }
        }

        // --- TICK AND STATS ---
        function tick() {
            if (player.health <= 0) return;
            if (player.isResting) {
                let energyGain = world[player.currentLocation].isFireLit ? 20 : 10;
                updateStats({ energy: energyGain, hunger: -0.5, thirst: -1 });
                if (player.energy >= 100) stopResting();
                return;
            }
            updateStats({ hunger: -2, thirst: -3 });
            if (player.hunger <= 0) { printToOutput("Sustenance critical. Vitality dropping.", "danger-color font-bold"); updateStats({ health: -5 }); }
            if (player.thirst <= 0) { printToOutput("Hydration critical. Vitality dropping.", "danger-color font-bold"); updateStats({ health: -5 }); }
        }
        
        function updateStats(changes) {
            if (changes.health !== undefined) player.health += changes.health;
            if (changes.hunger !== undefined) player.hunger += changes.hunger;
            if (changes.thirst !== undefined) player.thirst += changes.thirst;
            if (changes.energy !== undefined) player.energy += changes.energy;

            player.health = Math.max(0, Math.min(100, player.health));
            player.hunger = Math.max(0, Math.min(100, player.hunger));
            player.thirst = Math.max(0, Math.min(100, player.thirst));
            player.energy = Math.max(0, Math.min(100, player.energy));

            healthBar.style.width = healthText.textContent = `${Math.round(player.health)}%`;
            hungerBar.style.width = hungerText.textContent = `${Math.round(player.hunger)}%`;
            thirstBar.style.width = thirstText.textContent = `${Math.round(player.thirst)}%`;
            energyBar.style.width = energyText.textContent = `${Math.round(player.energy)}%`;
            
            if (player.health <= 0) gameOver();
        }

        // --- UI UPDATE FUNCTIONS ---
        function updateInventory() {
            inventoryList.innerHTML = '';
            if (player.inventory.length === 0) {
                inventoryList.innerHTML = `<li class="text-[var(--text-secondary)] italic p-2">Empty</li>`;
                return;
            }
            player.inventory.forEach(item => {
                const li = document.createElement('li');
                li.className = 'inventory-item p-2 rounded';
                li.innerHTML = `<span class="item-text">${item.name}</span><div class="item-details hidden text-sm text-[var(--text-secondary)] mt-2"></div>`;
                
                li.addEventListener('click', () => {
                    const currentlySelected = document.querySelector('.inventory-item.selected');
                    if(currentlySelected && currentlySelected !== li) {
                        currentlySelected.classList.remove('selected');
                        currentlySelected.querySelector('.item-details').classList.add('hidden');
                    }
                    li.classList.toggle('selected');
                    const details = li.querySelector('.item-details');
                    details.classList.toggle('hidden');
                    if(li.classList.contains('selected')) {
                        details.innerHTML = `
                            <p>${item.description}</p>
                            <div class="flex gap-2 mt-2">
                                <button class="inventory-action-button text-sm px-2 py-1 rounded" onclick="executeCommand('use ${item.name}')">Use</button>
                                <button class="inventory-action-button text-sm px-2 py-1 rounded" onclick="executeCommand('uses ${item.name}')">Uses</button>
                                <button class="inventory-action-button text-sm px-2 py-1 rounded" onclick="executeCommand('drop ${item.name}')">Drop</button>
                            </div>
                        `;
                    }
                });
                inventoryList.appendChild(li);
            });
        }

        function updateActionButtons() {
            actionButtons.innerHTML = '';
            const location = world[player.currentLocation];
            
            // Movement
            for (const dir in location.exits) {
                createActionButton(`Go ${dir}`, `go ${dir}`);
            }
            // Items
            location.items.forEach(item => {
                createActionButton(`Take ${item.name}`, `take ${item.name}`);
            });
            // Dino
            if (location.dino) {
                createActionButton(`Attack ${location.dino.name}`, `attack ${location.dino.name}`);
            }
            // General
            createActionButton('Look', 'look');
            if (location.type === 'stream') createActionButton('Drink', 'drink');
            createActionButton('Rest', 'rest');
        }

        function createActionButton(text, command) {
            const button = document.createElement('button');
            button.textContent = text;
            button.className = 'action-button p-2 rounded text-sm text-center';
            button.onclick = () => executeCommand(command);
            actionButtons.appendChild(button);
        }

        // --- UTILITY & INIT ---
        function printToOutput(text, className = 'text-primary') {
            const p = document.createElement('p');
            p.innerHTML = text;
            p.className = `${className} mb-1`;
            output.appendChild(p);
p.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }
        
        function gameOver() {
            printToOutput("\nBIO-SIGNALS FAILED...", "danger-color text-xl font-bold tracking-widest");
            printToOutput("SUBJECT DECEASED.", "danger-color text-xl font-bold tracking-widest");
            printToOutput("LOG TERMINATED. Refresh page to re-initialize.", "text-yellow-400/80");
            input.disabled = true;
        }

        function init() {
            generateWorld();
            printToOutput("System reboot... partial success. Chronometer failure. Environmental sensors active. You are... somewhere else. New directive: Survive.", "text-secondary italic");
            lookAround();
            updateStats({});
            updateInventory();
            
            input.addEventListener('keydown', (e) => { if (e.key === 'Enter') executeCommand(input.value); });
            setInterval(tick, 20000); 
        }

        init();
    </script>
</body>
</html>

